<!DOCTYPE html>

<html lang="zh-Hant-TW">
    <head>
        
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title> 使用 ConstraintLayout 建構畫面 | 只放拖鞋的鞋櫃 </title>
	<meta property="og:title" content=" 使用 ConstraintLayout 建構畫面 | 只放拖鞋的鞋櫃 " />
	<meta name="twitter:title" content=" 使用 ConstraintLayout 建構畫面 | 只放拖鞋的鞋櫃 ">

	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary">

	<meta name="description" content=" 使用 ConstraintLayout 建構畫面 | 只放拖鞋的鞋櫃 ">
	<meta property="og:description" content=" 使用 ConstraintLayout 建構畫面 | 只放拖鞋的鞋櫃 " />
	<meta name="twitter:description" content=" 使用 ConstraintLayout 建構畫面 | 只放拖鞋的鞋櫃 " />

	<link rel="icon" type="image/x-icon" href="https://jchu.cc/assets/favicon.ico">

	<link rel="image_src" href="https://jchu.cc/assets/default_avatar.jpg" >
	<meta property="og:image" content="https://jchu.cc/assets/default_avatar.jpg" />

	<link href="https://jchu.cc/atom.xml" title="只放拖鞋的鞋櫃" type="application/atom+xml" rel="alternative">

	<link rel="canonical" href="/2017/09/16-constraintlayout.html">

	<link rel="stylesheet" href="/asset/css/style.css">

    <link rel="stylesheet" href="/vendors/components-font-awesome/css/font-awesome.css">

    <meta name="generator" content="Hexo 5.4.0"></head>

    <body>
        
    <div class="layout-header">
        <header class="header">
            <div class="layout-logo">
                <div class="panel-logo">

                    <div class="box-logo">
                        <a href="/" title="只放拖鞋的鞋櫃"><img src="/assets/default_avatar.jpg" class="img-logo"></a>
                    </div>
                    <div class="box-main-title">
                        <h2><a href="/">Walkingice</a></h2>
                    </div>
                    <div class="box-sub-title">
                        
                            <p>Julian Chu, love Pixel-art and FF3. FOSS Developer. Co-founder of 0xLab. Join g0v.</p>
                        
                    </div>
                </div>
            </div>

            <div class="layout-menu">
                <div class="menu-group">
                    <nav>
                        <ul class="menu-list">
                            
                            <li class="menu-item">
                                <a href="/">
                                    <i class="fa fa-home gutter-right menu-icon"></i>
                                    <span class="menu-item">首頁</span>
                                </a>
                            </li>
                            
                            
                            <li class="menu-item">
                                <a href="/archives">
                                    <i class="fa fa-archive gutter-right"></i>
                                    <span class="menu-item">文章彙整</span>
                                </a>
                            </li>
                            
                            
                            <li class="menu-item">
                                <a href="/atom.xml">
                                    <i class="fa fa-rss-square gutter-right"></i>
                                    <span class="menu-item">RSS</span>
                                </a>
                            </li>
                            
                        </ul>
                    </nav>
                </div>

                
                <div class="menu-group">
                    <div class="menu-list">
                    
                        <div class="menu-item">
                            <a href="/lamejokes" target="_blank">
                                
                                    <i class="fa fa-comment gutter-right"></i>
                                
                            冷言冷語
                            </a>
                        </div>
                    
                        <div class="menu-item">
                            <a href="https://github.com/g0v" target="_blank">
                                
                                    <i class="fa fa-compass gutter-right"></i>
                                
                            g0v
                            </a>
                        </div>
                    
                    </div>
                </div>
                

                
                <div class="extra-comments">
                    <div>本站無留言功能，有問題或發現錯誤，歡迎到<a target="_blank" rel="noopener" href="https://twitter.com/walkingice">twitter</a>戳我，謝謝</div>
                </div>
                

                
                <div class="menu-group deflinks">
                    <div class="menu-list text-center">
                        
                        <a href="https://github.com/walkingice" target="_blank">
                            <i class="fa fa-github-square gutter-right menu-icononly"></i>
                        </a>
                        

                        
                        <a href="https://twitter.com/walkingice" target="_blank">
                            <i class="fa fa-twitter-square gutter-right menu-icononly"></i>
                        </a>
                        

                        

                        

                        

                        

                        

                    </div>
                </div>
                
            </div>

        </header>
    </div>

        <div class="layout-content">
            
<div class="row panel-content">
    

    <div class="article-wrap">
        <article class="content" itemscope itemtype="http://schema.org/Article" >
    <h1 class="article-title">
        <a href="/2017/09/16-constraintlayout.html" itemprop="url" target="_blank">
            <span class="">使用 ConstraintLayout 建構畫面</span>
        </a>
    </h1>

    <p>ConstraintLayout 是 Support Library 裡面新增的一個 ViewGroup，從功能上來看非常強大，效能上不輸、甚至<a href="https://android-developers.googleblog.com/2017/08/understanding-performance-benefits-of.html" target="_blank" rel="noopener">贏過</a>傳統的 Layout。因為放在 Support Library 裡面，幾乎市面上所有的手機都相容，就放心使用吧。</p>
<p>以往在建構複雜的畫面時，經常是 LinearLayout 與 RelativeLayout 等等相互組合，拼湊出相當深且複雜的樹狀 xml。略懂 View render 過程的都知道，效能就在層層的 measurement/layout 之中持續消耗。改用 ConstraintLayout 取代傳統 Layout 的複雜組合，把 xml 檔變得更加扁平，效率很容易就能提升。</p>
<p>粗看 ConstraintLayout 會覺得跟 RelativeLayout 有點像，其實它還能做到很多 RelativeLayout 做不到的事情。以下就稍微簡介 ConstraintLayout 的安裝與使用。</p>
<a id="more"></a>
<h1 id="專案裡面加入-ConstraintLayout"><a href="#專案裡面加入-ConstraintLayout" class="headerlink" title="專案裡面加入 ConstraintLayout"></a>專案裡面加入 ConstraintLayout</h1><p>由於 support libarary 已經被<a href="https://developer.android.com/jetpack/androidx/migrate" target="_blank" rel="noopener">整併進 AndroidX</a>，所以 package name 跟安裝方法跟以前都不一樣，我覺得這是改進，比以前好理解了。目前 AndroidX 的是初版本是 1.0.0，你的所有 AndroidX library 都是用這個版號。也可以個別為 ConstraintLayout 換上<a href="https://mvnrepository.com/artifact/com.android.support.constraint/constraint-layout" target="_blank" rel="noopener">比較新的版本</a></p>
<p>在 gradle 裡面照平常的步驟加進去 app/build.gradle 就行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">+    constraintLayoutLibVersion = &apos;1.1.3&apos;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line">dependencies &#123;</span><br><span class="line">+    implementation &quot;androidx.constraintlayout:constraintlayout:$&#123;constraintLayoutLibVersion&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ConstraintLayout-的使用介紹"><a href="#ConstraintLayout-的使用介紹" class="headerlink" title="ConstraintLayout 的使用介紹"></a>ConstraintLayout 的使用介紹</h1><p>以我的理解，ConstraintLayout 可以取代 RelativeLayout(不知是否可以完全取代)。還可以做到一些 RelativeLayout 做不到的事情，舉例來說</p>
<ol>
<li>利用 Guideline 來定位</li>
<li>透過 bias 對 view 的位置做一些偏移</li>
<li>用 ratio 的方式幫 view 調整大小</li>
<li>引入 chain 的概念，幫一組 views 做 Layout</li>
</ol>
<p>Android Studio 還提供了非常強大的 <a href="https://developer.android.com/studio/write/layout-editor.html" target="_blank" rel="noopener">Layout Editor</a> 讓開發者透過拖拉就完成 ConstraintLayout 的建置。雖然我個人還是喜歡用手敲，但是要設定 chain 的時候，用 Layout Editor 的確比較快。</p>
<h3 id="跟-RelativeLayout-相同的地方"><a href="#跟-RelativeLayout-相同的地方" class="headerlink" title="跟 RelativeLayout 相同的地方"></a>跟 RelativeLayout 相同的地方</h3><p>在 RelativeLayout 裡面都是一個 View A 當作基準點，讓另外一個 View B 根據 View A 的位置來排版，或是對齊 Parent 的上下左右。這些在 ConstraintLayout 裡面都有相當直觀的參數對應</p>
<ul>
<li>app:layout_constraintLeft_toLeftOf</li>
<li>app:layout_constraintLeft_toRightOf</li>
<li>app:layout_constraintRight_toLeftOf</li>
<li>….</li>
</ul>
<h4 id="置中"><a href="#置中" class="headerlink" title="置中"></a>置中</h4><p>要放到 parent 的中央，做法就有點不一樣。以水平置中為例，左邊對齊 parent 的左邊，右邊對齊 parent 的右邊，結果就是剛好會放在中間；垂直方向亦然。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<div style="max-width: 300px;" class="img-row"><img src="/2017/09/16-constraintlayout/01-center.png" title="Center view"></div>

<p>結果看起來如上圖。彎曲的線條，代表的意義有點類似彈簧，這個 View 的上下左右都被以相同力道拉扯，所以剛好擺在中間。當然還能透過 margin 去做微調。</p>
<h3 id="使用-Guideline"><a href="#使用-Guideline" class="headerlink" title="使用 Guideline"></a>使用 Guideline</h3><p>Guideline 是非常簡單的 View，它總是把自己設為 <code>View.GONE</code> 變成看不見，因此只是用來輔助定位的物件，可以有 vertical 與 horizontal 兩種</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_begin</span>=<span class="string">"100dp"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/btn_1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"@id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"@id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">"@id/btn_1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">"@id/btn_1"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/02-guideline.png" title="Using Guideline"></div>

<p>上面的範例中，我新增了一個 Guideline，位置在 parent 的左側的 100dp(RTL 的時候會剛好相反)。接著讓原本置中的 button，把左側對齊新增的 guideline。另外還新增了一個按鈕，左側一樣是對齊 guideline，右側則是對齊 btn_01 的左方。在兩邊拉扯之下，這個 button 就會擺在 guideline 與 btn 的中間。這件事情用 RelativeLayout 就很難做到。</p>
<p>Guideline 也可以用百分比的方式來擺放，如果使用 <code>app:layout_constraintGuide_percent=&quot;0.3&quot;</code> 就是從上方或是左方算起 30% 的地方放置 guideline。(不確定會不會有 RTL 的 issue)</p>
<h2 id="透過-bias-用百分比做位置的調整"><a href="#透過-bias-用百分比做位置的調整" class="headerlink" title="透過 bias 用百分比做位置的調整"></a>透過 bias 用百分比做位置的調整</h2><p>回到第一個範例，最基本的置中按鈕。還可以調整 bias 這個數值，讓 view 的位置會依此做出比例上的傾斜。(不同於 margin 是設定一個固定的數值)。bias 是一個 <strong>0.00 ~ 1.00</strong>的數值，有橫向的 <code>layout_constraintHorizontal_bias</code> 與垂直的 <code>layout_constraintVertical_bias</code>。</p>
<div class="img-row"><img src="/2017/09/16-constraintlayout/03-bias.png"></div>

<p>上圖就是同一個 button，把 <code>layout_constraintHorizontal_bias</code> 分別設定 <code>0.15</code>、<code>0.35</code> 與 <code>0.55</code> 三種數字的結果。影響著<strong>「計算旁邊的空間時，起始側應該要佔多少百分比」</strong>。所謂起始側，水平的 bias 則是左方(RTL 會剛好相反)，垂直方向則是上方。</p>
<h2 id="沒有-match-parent"><a href="#沒有-match-parent" class="headerlink" title="沒有 match_parent"></a>沒有 match_parent</h2><p>講到調整大小，首先要提醒 <strong>match_parent</strong> 與 <strong>match_constraint</strong>。</p>
<p>從 <a href="https://medium.com/google-developers/building-interfaces-with-constraintlayout-3958fa38a9f7" target="_blank" rel="noopener">Building interfaces with ConstraintLayout</a> 可以看到這麼一段話</p>
<blockquote>
<p>Match parent is not supported<br>Use match_constraint (0 dp) instead and attach constraints to the sides of the parent view if you wish. This provides similar functionality with correct handling of margins. “Match parent” should not be used inside ConstraintLayout at all.</p>
</blockquote>
<p>ConstraintLayout 裡面不該使用 <strong>match_parent</strong>，取而代之該使用 <strong>match_constraint</strong>。要用 <strong>match_constraint</strong>，其實也就只是設定成 <strong>0dp</strong> 就對了。(概念有點像 LinearLayout 裡面的 weight 與 0dp 的關係)。</p>
<p>想做到原本的 match parent，指定長度為 0dp 之後，把 start/end 或是 top/bottom 綁到 parent 即可。舉例來說，我想把 button 的寬度，從 guideline 開始，填滿到畫面最右側</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_begin</span>=<span class="string">"100dp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"@id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/04-no_match_parent.png"></div>

<h3 id="用-ratio-調整大小"><a href="#用-ratio-調整大小" class="headerlink" title="用 ratio 調整大小"></a>用 ratio 調整大小</h3><p>根據螢幕大小縮放一個固定長寬比的 View 是常見需求。決定了一個方向的尺寸，還可以透過 ratio 來動態計算另一個方向的大小。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/btn_1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintDimensionRatio</span>=<span class="string">"1:2"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/05-ratio.png"></div>

<p>上面的範例中，我把寬度固定為 <code>100dp</code>，讓高度動態調整，接著指定 width/height 比例為 <code>1:2</code>，於是高度就變成 200dp。</p>
<p>接著讓情況更複雜一點</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_begin</span>=<span class="string">"100dp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/btn_1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginStart</span>=<span class="string">"130dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintDimensionRatio</span>=<span class="string">"2:5"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"@id/guideline"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/06-ratio.png"></div>

<ol>
<li>button 的寬度是 wrap_content</li>
<li>100dp 的地方加上一個垂直 guideline</li>
<li>從 guideline 往右邊加上 130dp 的 margin，當作起點。終點是畫面右側，把 button 擺在兩點中間</li>
<li>高度是動態調整，與寬度的比例為 <code>2:5</code>。</li>
</ol>
<p>這麼複雜的情況，RelativeLayout 就很難做到了。依比例動態調整寬與高，是常見而以前不容易做到的需求，在 ConstraintLayout 中簡單許多。</p>
<h3 id="更複雜的-ratio-用法"><a href="#更複雜的-ratio-用法" class="headerlink" title="更複雜的 ratio 用法"></a>更複雜的 ratio 用法</h3><p>讓情況再複雜一點</p>
<p>如果兩邊都是 0dp，亦即寬與高都設定成 <strong>match_constraint</strong>，ratio 該怎麼使用？可以透過 <code>app:layout_constraintDimensionRatio=&quot;w,1:4&quot;</code> 這一類的寫法來指定基數為何。</p>
<ul>
<li><code>w,1:4</code> 的意思就是：希望 width 會動態調整，只要計算出高度，乘上 20% 當成是寬度</li>
<li><code>h,1:2</code> 的意思就是：希望 height 會動態調整，只要計算出寬度，乘上 50% 當成是高度</li>
</ul>
<p>舉例來說</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginStart</span>=<span class="string">"100dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintDimensionRatio</span>=<span class="string">"w,1:1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/07-ratio.png"></div>

<ol>
<li>Button 的寬度與高度都指定為 <strong>match_constraint</strong></li>
<li>Button 的上下左右都貼齊 parent</li>
<li>Button 左方有 100dp 的 margin</li>
</ol>
<p>所以 View 的計算方法就會是先垂直貼齊 parent，計算出高度之後。再把這個高度設定到 width 上面。我們可以清楚地看見一個正方形。</p>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/08-ratio.png"></div>

<p>如果把 margin 加大到 300dp，甚至可以看到 View 維持正方形，但是被推擠到外面去了。結果就是上圖。</p>
<p>維持 margin 為 300dp 的情況下，如果我們把 <code>w,1:1</code> 換成 <code>h,1:1</code> 呢？</p>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/09-ratio.png"></div>

<p>結果就是上圖。計算方法為：整個畫面的寬度減去 300dp 之後當成 view 的寬度，而 height 為動態調整，設定成跟寬度一樣。</p>
<h3 id="Chain"><a href="#Chain" class="headerlink" title="Chain"></a>Chain</h3><p>最後要介紹的概念就是 Chain。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:id</span>=<span class="string">"@+id/button1"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:text</span>=<span class="string">"Button"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">"@+id/button2"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:id</span>=<span class="string">"@+id/button2"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:text</span>=<span class="string">"Button"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">"@+id/button3"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">"@+id/button1"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:id</span>=<span class="string">"@+id/button3"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:text</span>=<span class="string">"Button"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">"@+id/button2"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 xml 的屬性裡面，只會看得見水平與垂直的 chainStyle 這兩個屬性跟 chain 有關。而 chain 是一個抽象的概念，只要兩個 views 的頭尾相連，則會成為一個 chain；當然數個 views 頭尾相連也行。形成 chain 之後，每個 view 之間的鏈結方法變得不一樣了。</p>
<p>形成一個 chain 的時候，最左邊或是最上面的 view，稱之為 <em>chain head</em>。給 chain head 指定 <code>layout_constraintHorizontal_chainStyle</code> 或 <code>layout_constraintVertical_chainStyle</code> 就能決定 chain 之中每個 view 的分佈方式。裡面的值可以是</p>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/10-chain.png"></div>

<ul>
<li>spread: 預設值，如上圖。每個 view 分布的位置是平均分佈</li>
</ul>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/11-chain.png"></div>

<ul>
<li>spread_inside: 頭尾的 view 靠到最旁邊之後，中間的 view 平均分佈</li>
</ul>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/12-chain.png"></div>

<ul>
<li>packed: 所有的 view 僅靠在一起</li>
</ul>
<div style="max-width: 400px;" class="img-row"><img src="/2017/09/16-constraintlayout/13-chain.png"></div>

<p>最後就是回到 LinearLayout 的邏輯。把寬度設定成 0dp 之後使用 <code>layout_constraintHorizontal_weight</code> 就能像以前在用 LinearLayout 一樣，以 weight 指定這個 view 需要佔據剩下空間的多少權重；垂直方向的用法也一樣。上圖就是把第一個 Button 的寬度設定為 0dp，並且指定 weight 為 1</p>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><p>以下記錄一些常常遇到的排版需求，複製貼上的速度會比較快</p>
<h2 id="在中央放一個-TextView"><a href="#在中央放一個-TextView" class="headerlink" title="在中央放一個 TextView"></a>在中央放一個 TextView</h2><p>通常用來顯示某一個區塊的 Title</p>
<ol>
<li>因為是 title，希望會置中</li>
<li>title 可能長或可能短，但是設計師通常會說「如果字串太長，就佔 60% 寬為極限」</li>
</ol>
<p>我的方法是左右增加兩個 guideline，位置由百分比決定。然後把 TextView 的左右 align guideline，寬度為 <code>wrap_content</code> 並且指定 <code>app:layout_constrainedWidth</code>。我還刻意加了一個 drawable 進去，反正這也是常被要求的東西。</p>
<div style="max-width: 100%;" class="img-row"><img src="/2017/09/16-constraintlayout/14-example.png" title="Example"></div>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/title_guideline_left"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_percent</span>=<span class="string">"0.2"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/title_guideline_right"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_percent</span>=<span class="string">"0.8"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/title"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:drawableStart</span>=<span class="string">"@android:drawable/arrow_down_float"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:drawablePadding</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:includeFontPadding</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">"@string/common_back_to"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constrainedWidth</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"@id/title_guideline_left"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"@id/title_guideline_right"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:text</span>=<span class="string">"@tools:sample/lorem/random"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<hr>

<ul>
<li>20190314 更新：修改關於 androidx 的部分，並加上一些範例</li>
</ul>
<p>若有寫錯的地方，還請到 <a href="https://twitter.com/walkingice" target="_blank" rel="noopener">twitter</a> 提醒我一下，謝謝</p>


    
</article>


        <div class="article-meta content">
    <div class="groups">
        <span class="group">
            <a class="archive-item-date" href="https://jchu.cc/2017/09/16-constraintlayout.html">
                <i class="fa fa-calendar"></i>
                <span
                    itemprop="datePublished"
                    content="2017-09-16">2017-09-16</span>
            </a>
        </span>

        <span class="group">
            
            
                <a href="/categories/geek/">
                    <i class="fa fa-th"></i>
                    <span class="">geek</span>
                </a>
            
        </span>

        <span class="group float-right">
            
            
                <a href="/tags/tools/">
                    <span class="tag">tools</span>
                </a>
            
                <a href="/tags/Android/">
                    <span class="tag">Android</span>
                </a>
            
        </span>
    </div>

</div>



    </div>

    <div class="panel-post-nav">
        <div class="box-post-nav">
            
                <a class="btn" href="/2018/01/29-env.html" title="日常能做的環保小事"><b>日常能做的環保小事</b> &larr; Prev</a>
            
            
                <a class="btn" href="/2017/09/13-checkstyle.html" title="使用 Checkstyle/Ktlint 檢查 Java/Kotlin 語法">Next &rarr; <b>使用 Checkstyle/Ktlint 檢查 Java/Kotlin 語法</b></a>
            
        </div>
    </div>
</div>


        </div>
        
<div class="layout-footer" style="clear: both">
    <div class="panel-footer">
        <div class="box-footer">
            <footer class="footer">
                
                <a target="_blank" rel="noopener" href="http://creativecommons.org/">
                    License: <i class="fa fa-cc"></i> by-nc-sa
                </a>
                
                <p class="theme">Powered by
                    <a href="http://hexo.io/" target="_blank">Hexo</a>,
                    Theme
                    <a href="https://github.com/walkingice/hexo-theme-kaku" target="_blank">Kaku</a>
                </p>
            </footer>
        </div>
    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-2502077-5', 'auto');
    ga('send', 'pageview');
</script>



    </body>
</html>
