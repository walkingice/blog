<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="625px" preserveAspectRatio="none" style="width:1015px;height:625px;" version="1.1" viewBox="0 0 1015 625" width="1015px" zoomAndPan="magnify"><defs><filter height="300%" id="fn13iky66yke1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="303" x="347" y="17.4023">Generate Google Authenticator URI</text><g id="OriginalKey"><rect fill="#FEFECE" filter="url(#fn13iky66yke1)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="150" x="226" y="28.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="226" x2="376" y1="54.6875" y2="54.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="261.5" y="46.7344">OriginalKey</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="130" x="231" y="71.2891">"GoAheadMakeMyDay"</text></g><g id="ByteArray"><rect fill="#FEFECE" filter="url(#fn13iky66yke1)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="340" x="131" y="140.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="131" x2="471" y1="166.6875" y2="166.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="268.5" y="158.7344">ByteArray</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="320" x="136" y="183.2891">[47 6f 41 68 65 61 64 4d 61 6b 65 4d 79 44 61 79]</text></g><g id="Secret"><rect fill="#FEFECE" filter="url(#fn13iky66yke1)" height="64.7539" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="273" x="164.5" y="298.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="164.5" x2="437.5" y1="324.6875" y2="324.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="280" y="316.7344">Secret</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="253" x="169.5" y="341.2891">I5XUC2DFMFSE2YLLMVGXSRDBPE======</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="235" x="169.5" y="355.4219">append '=', until secret.length % 8 == 0</text></g><path d="M473,268.1992 L473,326.6992 L437.56,330.6992 L473,334.6992 L473,393.373 A0,0 0 0 0 473,393.373 L1003,393.373 A0,0 0 0 0 1003,393.373 L1003,278.1992 L993,268.1992 L473,268.1992 A0,0 0 0 0 473,268.1992 " fill="#FBFB77" filter="url(#fn13iky66yke1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M993,268.1992 L993,278.1992 L1003,278.1992 L993,268.1992 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="479" y="285.7676">group every 5 bits</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="479" y="301.0781">[11110000, 10101010, 00001111]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="509" x="479" y="316.3887">-&gt; [11110, 00010, 10101, 00000, 1111 0]  append 0 because 1111 is only 4 bits</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="479" y="331.6992">-&gt; [0001_1110, 0000_0010, 0001_0101, 0000_0000, 0001_1110] byte to int</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="474" x2="1002" y1="334.4414" y2="334.4414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="474" x2="1002" y1="336.4414" y2="336.4414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="479" y="351.0098">-&gt; 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="479" y="366.3203">-&gt; 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="479" y="381.6309">-&gt; '2', '3', '4', '5', '6', '7') =&gt; 32 chars</text><g id="URI"><rect fill="#FEFECE" filter="url(#fn13iky66yke1)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="588" x="7" y="454.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="595" y1="480.6875" y2="480.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="289.5" y="472.7344">URI</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="568" x="12" y="497.2891">otpauth://totp/foobar?digits=6&amp;issuer=TEST&amp;secret=I5XUC2DFMFSE2YLLMVGXSRDBPE======</text></g><rect fill="#FEFECE" filter="url(#fn13iky66yke1)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="268" y="566.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="273" y="591.4902">QRCode</text><!--MD5=[810c0628924d8236646c276bffde1c91]
link OriginalKey to ByteArray--><path d="M301,79.3892 C301,95.7992 301,117.4592 301,134.8492 " fill="none" id="OriginalKey-&gt;ByteArray" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="301,140.0992,305,131.0992,301,135.0992,297,131.0992,301,140.0992" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[9f229c3400de1156a5f9a78f2f769a64]
link ByteArray to Secret--><path d="M301,191.4592 C301,218.3992 301,261.7592 301,292.7392 " fill="none" id="ByteArray-&gt;Secret" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="301,297.9792,305,288.9792,301,292.9792,297,288.9792,301,297.9792" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="302" y="234.7676">Base32</text><!--MD5=[658bb332f7da5e1927d7c8ba59d038de]
link Secret to URI--><path d="M301,363.2392 C301,388.5992 301,423.9792 301,448.8792 " fill="none" id="Secret-&gt;URI" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="301,454.0192,305,445.0192,301,449.0192,297,445.0192,301,454.0192" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e045d74ea040c34d9ac4019e08db690d]
link URI to QRCode--><path d="M301,505.1992 C301,522.0392 301,544.2892 301,561.0592 " fill="none" id="URI-&gt;QRCode" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="301,566.0692,305,557.0692,301,561.0692,297,557.0692,301,566.0692" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f2b670892498fb0f8c3c6576de46a3e0]
@startuml

title Generate Google Authenticator URI

hide empty description

OriginalKey -down-> ByteArray
OriginalKey: "GoAheadMakeMyDay"
ByteArray: [47 6f 41 68 65 61 64 4d 61 6b 65 4d 79 44 61 79]

ByteArray -down-> Secret: Base32
Secret: I5XUC2DFMFSE2YLLMVGXSRDBPE======
Secret: append '=', until secret.length % 8 == 0
note right
  group every 5 bits
  [11110000, 10101010, 00001111]
  -> [11110, 00010, 10101, 00000, 1111 0]  append 0 because 1111 is only 4 bits
  -> [0001_1110, 0000_0010, 0001_0101, 0000_0000, 0001_1110] byte to int
  ==
  -> 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
  -> 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
  -> '2', '3', '4', '5', '6', '7') => 32 chars
end note

Secret -down-> URI
URI: otpauth://totp/foobar?digits=6&issuer=TEST&secret=I5XUC2DFMFSE2YLLMVGXSRDBPE======
URI -down-> QRCode

@enduml

PlantUML version 1.2020.13(Sat Jun 13 21:26:38 JST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: JP
--></g></svg>