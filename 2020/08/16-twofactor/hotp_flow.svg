<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1100px" preserveAspectRatio="none" style="width:702px;height:1100px;" version="1.1" viewBox="0 0 702 1100" width="702px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wubx4xzvl8eq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="48" x="318.25" y="17.4023">HOTP</text><g id="Key"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="150" x="102" y="252.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="102" x2="252" y1="278.6875" y2="278.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="24" x="165" y="270.7344">Key</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="130" x="107" y="295.2891">"GoAheadMakeMyDay"</text></g><g id="KeyByteArray"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="340" x="7" y="380.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="347" y1="406.6875" y2="406.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="132.5" y="398.7344">KeyByteArray</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="320" x="12" y="423.2891">[47 6f 41 68 65 61 64 4d 61 6b 65 4d 79 44 61 79]</text></g><g id="Counter"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="420.5" y="28.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="519.5" y1="54.6875" y2="54.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="442" y="46.7344">Counter</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="79" x="425.5" y="71.2891">65535 (Long)</text></g><g id="CounterHexValue"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="399.5" y="140.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="399.5" x2="540.5" y1="166.6875" y2="166.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="409.5" y="158.7344">CounterHexValue</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="39" x="404.5" y="183.2891">0xFFFF</text></g><g id="CounterHexString"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="241" x="349.5" y="252.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349.5" x2="590.5" y1="278.6875" y2="278.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="408" y="270.7344">CounterHexString</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="221" x="354.5" y="295.2891">"000000000000FFFF" String, size=16</text></g><g id="CounterByteArray"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="382" y="380.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="382" x2="558" y1="406.6875" y2="406.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="409.5" y="398.7344">CounterByteArray</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="156" x="387" y="423.2891">[00 00 00 00 00 00 FF FF]</text></g><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="298" y="492.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="304.5" y="517.4902">SHA1</text><g id="Digest"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="64.7539" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="453" x="96.5" y="593.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="96.5" x2="549.5" y1="619.6875" y2="619.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="301.5" y="611.7344">Digest</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="433" x="101.5" y="636.2891">hs = [16 66 4A 59 58 57 E2 55 22 DC A3 1B 97 A9 C4 B5 7E D7 77 25]</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="223" x="101.5" y="650.4219">get 20 bytes length array, digest value</text></g><g id="hs_19"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="61" x="234.5" y="726.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="234.5" x2="295.5" y1="752.6875" y2="752.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="244.5" y="744.7344">hs_19</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="24" x="239.5" y="769.2891">[25]</text></g><g id="Offset"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="64.7539" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="80.5" y="875.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="80.5" x2="247.5" y1="901.6875" y2="901.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="143.5" y="893.7344">Offset</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="8" x="85.5" y="918.2891">5</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="85.5" y="932.4219">Always 0~15 (0x0 ~ 0xF)</text></g><g id="hs_4_bytes"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="64.7539" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="380.5" y="719.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="380.5" x2="483.5" y1="745.6875" y2="745.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="394.5" y="737.7344">hs_4_bytes</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="83" x="385.5" y="762.2891">[57 E2 55 22]</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="74" x="385.5" y="776.4219">hs[5] ~ hs[8]</text></g><g id="Result"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="93.0195" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="401" x="282.5" y="861.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="282.5" x2="683.5" y1="887.6875" y2="887.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="462" y="879.7344">Result</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="145" x="287.5" y="904.2891">hs_4_bytes &amp; 0x7FFFFFFF</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="367" x="287.5" y="918.4219">hs_4_bytes &amp; 0x0111 1111 11111111 11111111 11111111</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="381" x="287.5" y="932.5547">0x57E25522 &amp; 0x0111 1111 11111111 11111111 11111111</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="104" x="287.5" y="946.6875">Got 1474450722</text></g><g id="Truncate"><rect fill="#FEFECE" filter="url(#f1wubx4xzvl8eq)" height="50.6211" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="442.5" y="1031.1992"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="442.5" x2="523.5" y1="1057.6875" y2="1057.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="452.5" y="1049.7344">Truncate</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="447.5" y="1074.2891">450722</text></g><!--MD5=[ac6b158425c48ff6d3d735d1dbff7338]
link Key to KeyByteArray--><path d="M177,303.2892 C177,323.8492 177,353.2192 177,375.0692 " fill="none" id="Key-&gt;KeyByteArray" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="177,380.1692,181,371.1692,177,375.1692,173,371.1692,177,380.1692" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="178" y="346.7676">to byte array</text><!--MD5=[49bb6e023cd2921601de6f7287786ee0]
link Counter to CounterHexValue--><path d="M470,79.3892 C470,95.7992 470,117.4592 470,134.8492 " fill="none" id="Counter-&gt;CounterHexValue" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="470,140.0992,474,131.0992,470,135.0992,466,131.0992,470,140.0992" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[0ccfe03e05937dd0dbffbac164bb88ee]
link CounterHexValue to CounterHexString--><path d="M470,191.3892 C470,207.7992 470,229.4592 470,246.8492 " fill="none" id="CounterHexValue-&gt;CounterHexString" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="470,252.0992,474,243.0992,470,247.0992,466,243.0992,470,252.0992" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[a17598d55e6a0af66d4e264dadd65ee0]
link CounterHexString to CounterByteArray--><path d="M470,303.2892 C470,323.8492 470,353.2192 470,375.0692 " fill="none" id="CounterHexString-&gt;CounterByteArray" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="470,380.1692,474,371.1692,470,375.1692,466,371.1692,470,380.1692" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[79a996151fcf2a6166ce99a08a698072]
link CounterByteArray to SHA1--><path d="M435.54,431.1992 C410.29,449.1492 376.39,473.2492 352.42,490.2892 " fill="none" id="CounterByteArray-&gt;SHA1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="348.06,493.3892,357.7144,491.4418,352.1373,490.4952,353.0839,484.9181,348.06,493.3892" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[58579c2298b698927478cbfd7cb4e467]
link KeyByteArray to SHA1--><path d="M211.23,431.1992 C236.14,449.0292 269.55,472.9392 293.33,489.9592 " fill="none" id="KeyByteArray-&gt;SHA1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="297.66,493.0592,292.6839,484.5599,293.5991,490.1422,288.0167,491.0574,297.66,493.0592" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f77630769e2e26ec025b2ebcff361495]
link SHA1 to Digest--><path d="M323,532.3692 C323,547.6192 323,569.4092 323,587.9992 " fill="none" id="SHA1-&gt;Digest" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="323,593.1492,327,584.1492,323,588.1492,319,584.1492,323,593.1492" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[1edb045551fcca1e110ba8dbe34a83ba]
link Digest to hs_19--><path d="M308.21,658.3092 C299.12,677.7592 287.54,702.5092 278.66,721.4892 " fill="none" id="Digest-&gt;hs_19" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="276.46,726.1892,283.8918,719.7264,278.5752,721.6587,276.6429,716.3421,276.46,726.1892" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[187d368325d0452494a205ba0df308bb]
link hs_19 to Offset--><path d="M248.77,777.4392 C232.26,802.6192 206.49,841.9192 187.69,870.5792 " fill="none" id="hs_19-&gt;Offset" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="184.74,875.0792,193.0185,869.7439,187.4805,870.8971,186.3272,865.3591,184.74,875.0792" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="225" y="827.7676">&amp;0F</text><!--MD5=[a0023ce49fe331950887e96e2cb287e9]
link Digest to hs_4_bytes--><path d="M350.79,658.3092 C366.03,675.6592 384.99,697.2192 400.75,715.1392 " fill="none" id="Digest-&gt;hs_4_bytes" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="404.26,719.1492,401.3261,709.7475,400.9604,715.3925,395.3154,715.0269,404.26,719.1492" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[fdd2f0ed7ba84b1ba0d16f9df06c4501]
link hs_4_bytes to Result--><path d="M442.44,784.2392 C449.3,804.9392 458.42,832.4692 466.27,856.1892 " fill="none" id="hs_4_bytes-&gt;Result" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="467.93,861.1892,468.9052,851.3888,466.3617,856.4415,461.3089,853.898,467.93,861.1892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="458" y="827.7676">remove first bit</text><!--MD5=[875c43f74cbe63f6ccb676f7e86441f9]
link Result to Truncate--><path d="M483,954.4092 C483,977.7192 483,1005.3992 483,1025.9292 " fill="none" id="Result-&gt;Truncate" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="483,1030.9892,487,1021.9892,483,1025.9892,479,1021.9892,483,1030.9892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="484" y="997.7676">Last 6 number</text><!--MD5=[610425fa9651fead8be95e01c9a9020e]
@startuml

title HOTP

hide empty description

Key -down-> KeyByteArray: to byte array
Key: "GoAheadMakeMyDay"

Counter -down-> CounterHexValue
Counter: 65535 (Long)

CounterHexValue -down-> CounterHexString
CounterHexValue: 0xFFFF

CounterHexString -down-> CounterByteArray
CounterHexString: "000000000000FFFF" String, size=16

CounterByteArray -down-> SHA1
CounterByteArray: [00 00 00 00 00 00 FF FF]

KeyByteArray: [47 6f 41 68 65 61 64 4d 61 6b 65 4d 79 44 61 79]

' Integer.toHexString(hs[0].toUByte.toInt())
' https://www.rapidtables.com/convert/number/decimal-to-hex.html
KeyByteArray -down-> SHA1

SHA1 -down-> Digest

Digest: hs = [16 66 4A 59 58 57 E2 55 22 DC A3 1B 97 A9 C4 B5 7E D7 77 25]
Digest: get 20 bytes length array, digest value

Digest -down-> hs_19
hs_19: [25]

hs_19 -down-> Offset: &0F
Offset: 5
Offset: Always 0~15 (0x0 ~ 0xF)

Digest -down->hs_4_bytes
hs_4_bytes: [57 E2 55 22]
hs_4_bytes: hs[5] ~ hs[8]

hs_4_bytes -down-> Result : remove first bit
Result: hs_4_bytes & 0x7FFFFFFF
Result: hs_4_bytes & 0x0111 1111 11111111 11111111 11111111
Result: 0x57E25522 & 0x0111 1111 11111111 11111111 11111111
Result: Got 1474450722

Result -down-> Truncate : Last 6 number
Truncate: 450722

@enduml

@startuml

title HOTP

hide empty description

Key -down-> KeyByteArray: to byte array
Key: "GoAheadMakeMyDay"

Counter -down-> CounterHexValue
Counter: 65535 (Long)

CounterHexValue -down-> CounterHexString
CounterHexValue: 0xFFFF

CounterHexString -down-> CounterByteArray
CounterHexString: "000000000000FFFF" String, size=16

CounterByteArray -down-> SHA1
CounterByteArray: [00 00 00 00 00 00 FF FF]

KeyByteArray: [47 6f 41 68 65 61 64 4d 61 6b 65 4d 79 44 61 79]

KeyByteArray -down-> SHA1

SHA1 -down-> Digest

Digest: hs = [16 66 4A 59 58 57 E2 55 22 DC A3 1B 97 A9 C4 B5 7E D7 77 25]
Digest: get 20 bytes length array, digest value

Digest -down-> hs_19
hs_19: [25]

hs_19 -down-> Offset: &0F
Offset: 5
Offset: Always 0~15 (0x0 ~ 0xF)

Digest -down->hs_4_bytes
hs_4_bytes: [57 E2 55 22]
hs_4_bytes: hs[5] ~ hs[8]

hs_4_bytes -down-> Result : remove first bit
Result: hs_4_bytes & 0x7FFFFFFF
Result: hs_4_bytes & 0x0111 1111 11111111 11111111 11111111
Result: 0x57E25522 & 0x0111 1111 11111111 11111111 11111111
Result: Got 1474450722

Result -down-> Truncate : Last 6 number
Truncate: 450722

@enduml

PlantUML version 1.2020.13(Sat Jun 13 21:26:38 JST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: JP
--></g></svg>